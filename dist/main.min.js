window.retro=angular.module("retrospective",[]).value("version",5.2).controller("MainCtrl",["$scope","version","printService",function(c,a,b){c.today=new Date();c.version=a;c.$on("print",function(){b.write("print-header.html",{today:c.today})})}]).controller("TopicCtrl",["$scope","$attrs","TopicsModel","$rootScope","printService",function(f,d,c,b,e){var g,h;b.$on("print",a);f.$on("topics.clear",function(){h.clear()});f.topics=h=new c(d.topId,d.topPlaceholder);f.add=function(i){h.add({name:i});this.newTopic=""};f.editTopic=function(i){g=angular.extend({},i);i.editing=true};f.doneEditing=function(i){if(i.editing&&i.name.length===0){h.remove(i)}h.endEditing(i)};f.revertEditing=function(i){h.list[h.list.indexOf(i)]=g;i.editing=false;g=null};function a(){if(h.list.length>0){e.write("print-placeholder.html",{placeholder:h.placeholder});h.list.forEach(function(i){e.write("print-topic.html",{votes:i.votes,name:i.name})})}}}]).factory("TopicsModel",["$window",function(b){function a(d,c){this.id=d;this.placeholder=c;this.list=angular.fromJson(b.localStorage.getItem(d))||[];this.editing=false}a.prototype={add:function(c){if(c.name&&c.name.length){this.list.unshift(c);this.save()}},save:function(){b.localStorage.setItem(this.id,angular.toJson(this.list))},remove:function(d){var e=this.list,c=e.indexOf(d);if(c>=0){e.splice(e.indexOf(d),1);this.save()}},clear:function(){this.list=[];this.save()},endEditing:function(c){if(c.editing){c.editing=false;this.save()}}};return a}]).directive("topVoting",function(){return{priority:100,restrict:"A",require:"^TopicCtrl",scope:"=",controller:["$scope","$rootScope",function(b,a){b.isVotingEnabled=true;a.$on("sort",function(){b.topics.list.sort(function(d,c){return(d.votes||0)-(c.votes||0)});b.topics.save()});b.add=function(c){b.topics.add({name:c,votes:0});this.newTopic=""};b.increment=function(c){c.votes++;b.topics.save()}}]}}).service("printService",["$templateCache","$interpolate",function(a,b){return{write:function(d,e){var c=a.get(d);document.write(b(c)(e))}}}]).directive("forceNumeric",function(){return{require:"ngModel",restrict:"A",link:function(d,c,b,a){a.$parsers.push(e);function e(g){var f=g.replace(/[^0-9]/g,"");if(f!==g){a.$setViewValue(f);a.$render()}return f}}}}).directive("focusInput",["$timeout",function(a){return function(c,d,b){c.$watch(b.focusInput,function(e){if(e){a(function(){d[0].focus()},0,false)}})}}]).directive("escInInput",function(){var a=27;return function(c,d,b){d.on("keydown",function(f){if(f.keyCode===a){c.$apply(b.escInInput)}})}});
